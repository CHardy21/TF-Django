{% extends 'dashboard_base.html' %}

{% block title %}
  Estad√≠sticas
{% endblock %}

{% block main_content %}
  <section id="estadisticas">
    <h2>üìã Mis Estad√≠sticas</h2>
    <form method="get">
      <label>Desde:</label>
      <input type="date" name="fecha_inicio" value="{{ fecha_inicio }}" />
      <label>Hasta:</label>
      <input type="date" name="fecha_fin" value="{{ fecha_fin }}" />
      <button type="submit">Filtrar</button>
    </form>

    <ul>
      <li>Total: {{ total_posts }}</li>
      <li>Publicadas: {{ publicados }}</li>
      <li>Borradores: {{ borradores }}</li>
      <li>Comentarios: {{ total_comentarios }}</li>
      <li>Promedio vistas: {{ promedio_vistas|floatformat:1 }}</li>
    </ul>

    <div class="chart-container">
      <canvas id="graficoPublicaciones"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="graficoVistas"></canvas>
    </div>
  </section>

  <section id="top">
    <h3>üèÜ Top publicaciones</h3>
    <ol>
      {% for post in top_posts %}
        <li>{{ post.titulo }} ‚Äî {{ post.vistas }} vistas</li>
      {% endfor %}
    </ol>
  </section>
{% endblock %}
{% block scripts %}
  <script src="{% static 'dashboard/dashboard.js' %}"></script>
  <script>
    new Chart(document.getElementById('graficoPublicaciones'), {
      type: 'doughnut',
      data: {
        labels: ['Publicadas', 'Borradores'],
        datasets: [{
          data: [{{ publicados }}, {{ borradores }}],
          backgroundColor: ['#28a745', '#ffc107'],
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: 'Estado de Publicaciones'
          }
        }
      }
    });

    new Chart(document.getElementById('graficoVistas'), {
      type: 'bar',
      data: {
        labels: {{ labels|safe }},
        datasets: [{
          label: 'Vistas',
          data: {{ views|safe }},
          backgroundColor: '#17a2b8'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: 'Publicaciones m√°s vistas'
          }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  </script>
{% endblock %}
